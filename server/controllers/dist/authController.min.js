"use strict";function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,n)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(t,!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var User=require("../models/userModel.js"),bcrypt=require("bcryptjs"),jwt=require("jsonwebtoken");exports.signup=function(r,t,n){var s,a,o,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(User.findOne({email:r.body.email}));case 3:if(e.sent)throw(s=new Error("User already exists!")).statusCode=400,s;e.next=8;break;case 8:return e.next=10,regeneratorRuntime.awrap(bcrypt.hash(r.body.password,12));case 10:return a=e.sent,e.next=13,regeneratorRuntime.awrap(User.create(_objectSpread({},r.body,{password:a})));case 13:o=e.sent,c=jwt.sign({_id:o._id},process.env.JWT_SECRET,{expiresIn:"1d"}),t.status(201).json({status:"success",message:"User registered successfully",token:c,user:{_id:o._id,name:o.name,email:o.email,role:o.role}}),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),n(e.t0);case 21:case"end":return e.stop()}},null,null,[[0,18]])},exports.login=function(r,t,n){var s,a,o,c,i,u,p;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=r.body,a=s.email,o=s.password,e.next=4,regeneratorRuntime.awrap(User.findOne({email:a}));case 4:if(c=e.sent){e.next=9;break}throw(i=new Error("User not found")).statusCode=404,i;case 9:return e.next=11,regeneratorRuntime.awrap(bcrypt.compare(o,c.password));case 11:if(e.sent){e.next=16;break}throw(u=new Error("Incorrect Password or Email")).statusCode=401,u;case 16:p=jwt.sign({_id:c._id},process.env.JWT_SECRET,{expiresIn:"1d"}),t.status(200).json({status:"success",token:p,message:"Logged in Successfully",user:{_id:c._id,name:c.name,email:c.email,role:c.role}}),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),n(e.t0);case 23:case"end":return e.stop()}},null,null,[[0,20]])};
//# sourceMappingURL=authController.min.js.map
